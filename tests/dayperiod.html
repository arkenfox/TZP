<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>dayperiod</title>
<style>
</style>
</head>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=800">
	<title>pluralrules</title>
	<link rel="stylesheet" type="text/css" href="testindex.css">
	<script src="testglobals.js"></script>
	<script src="testgeneric.js"></script>
	<!-- custom -->
	<style>
		table {width: 780px;}
		hr {color: #dcdc8c}
	</style>
</head>
<body>

	<table>
	<tr><td><h2>TorZillaPrint</h2></td></tr>
	<tr><td class="blurb"><a class="return" href="../index.html">return to TZP index</a></td></tr>
	</table>

	<table id="tb4">
		<col width="30%"><col width="70%">
		<thead><tr><th colspan="2">
			<div class="nav-title">dayPeriod
			<div class="nav-up"><span class="c perf" id="perf"></span></div>
			</div>
		</th></tr></thead>
		<tr><td colspan="2" class="intro">
			<span class="no_color">Testing language results in dayPeriod</span>
		</td></tr>
		<tr>
			<td class="mono spaces" id="legend" style="text-align: left; vertical-align: top; color: #b3b3b3; font-size: 11px"></td>
			<td class="mono" style="text-align: left; vertical-align: top;">
					<div class="btn">
						<span id="bnarrow" class="btn4 btn" onClick="run('narrow')">[ NARROW ]</span>
						<span id="bshort" class="btn4 btn" onClick="run('short')">[ SHORT ]</span>
						<span id="blong" class="btn4 btn" onClick="run('long')">[ LONG ]</span>
						<span id="ball" class="btn4 btn" onClick="run('all')">[ ALL ]</span>
						<span class="btn4 btn"><input type="checkbox" id="supported"> supported locales only</span>
					</div>
				<br><br><hr><br>
				<span id ="results"></span>
			</td></tr>
	</table>
	<br>

<script>
var detailed = [
"aa,afar",
"ab,abkhazian",
"ach,acholi",
"ae,avestan",
"af,afrikaans",
"ak,akan",
"am,amharic",
"an,aragonese",
"ar,arabic",
"as,assamese",
"ast,asturian",
"av,avaric",
"ay,aymara",
"az,azerbaijani",
"ba,bashkir",
"be,belarusian",
"bg,bulgarian",
"bh,bihari",
"bi,bislama",
"bm,bambara",
"bn,bengali",
"bo,tibetan",
"br,breton",
"bs,bosnian",
"ca,catalan",
"cak,kaqchikel",
"ce,chechen",
"ch,chamorro",
"ckb,central kurdish", // ? dropped
"co,corsican",
"cr,cree",
"crh,crimean tatar",
"cs,czech",
"csb,kashubian",
"cu,church slavic",
"cv,chuvash",
"cy,welsh",
"da,danish",
"de,german",
"dsb,lower sorbian",
"dv,divehi",
"dz,dzongkha",
"ee,ewe",
"el,greek",
"en,english",
"eo,esperanto",
"es,spanish",
"et,estonian",
"eu,basque",
"fa,persian",
"ff,fulah",
"fi,finnish",
"fj,fijian",
"fo,faroese",
"fr,french",
"fur,friulian",
"fy,frisian",
"ga,irish",
"gd,scottish gaelic",
"gl,galician",
"gn,guarani",
"gu,gujarati",
"gv,manx",
"ha,hausa",
"haw,hawaiian",
"he,hebrew",
"hi,hindi",
"hil,hiligaynon",
"ho,hiri motu",
"hr,croatian",
"hsb,upper sorbian",
"ht,haitian",
"hu,hungarian",
"hy,armenian",
"hye,eastern armenian", // ? dropped
"hz,herero",
"ia,interlingua",
"id,indonesian",
"ie,interlingue",
"ig,igbo",
"ii,sichuan yi",
"ik,inupiaq",
"io,ido",
"is,icelandic",
"it,italian",
"iu,inuktitut",
"ja,japanese",
"jv,javanese",
"ka,georgian",
"kab,kabyle",
"kg,kongo",
"ki,kikuyu",
"kj,kuanyama",
"kk,kazakh",
"kl,greenlandic",
"km,khmer",
"kn,kannada",
"ko,korean",
"kok,konkani",
"kr,kanuri",
"ks,kashmiri",
"ku,kurdish",
"kv,komi",
"kw,cornish",
"ky,kirghiz",
"la,latin",
"lb,luxembourgish",
"lg,ganda",
"li,limburgan",
"lij,ligurian",
"ln,lingala",
"lo,lao",
"lt,lithuanian",
"ltg,latgalian",
"lu,luba-katanga",
"lv,latvian",
"mai,maithili",
"meh,sw tlaxiaco mixtec",
"mg,malagasy",
"mh,marshallese",
"mi,maori",
"mix,mixtepec mixtec",
"mk,macedonian",
"ml,malayalam",
"mn,mongolian",
"mr,marathi",
"ms,malay",
"mt,maltese",
"my,burmese",
"na,nauru",
"nb,norwegian bokmål",
"nd,ndebele north",
"ne,nepali",
"ng,ndonga",
"nl,dutch",
"nn,norwegian nynorsk",
"no,norwegian",
"nr,ndebele south",
"nso,sotho northern",
"nv,navajo",
"ny,chichewa",
"oc,occitan",
"oj,ojibwa",
"om,oromo",
"or,odia",
"os,ossetian",
"pa,punjabi",
"pi,pali",
"pl,polish",
"ps,pashto",
"pt,portuguese",
"qu,quechua",
"rm,rhaeto-romanic",
"rn,kirundi",
"ro,romanian",
"ru,russian",
"rw,kinyarwanda",
"sa,sanskrit",
"sc,sardinian",
"sco,scots", // 1714293
"sd,sindhi",
"se,northern sami",
"sg,sango",
"si,singhalese",
"sk,slovak",
"sl,slovenian",
"sm,samoan",
"sn,shona",
"so,somali",
"son,songhay",
"sq,albanian",
"sr,serbian",
"ss,siswati",
"st,sotho southern",
"su,sundanese",
"sv,swedish",
"sw,swahili",
"szl,silesian", // 1691695
"ta,tamil",
"te,telugu",
"tg,tajik",
"th,thai",
"ti,tigrinya",
"tig,tigre",
"tk,turkmen",
"tl,tagalog",
"tlh,klingon",
"tn,tswana",
"to,tonga",
"tr,turkish",
"trs,triqui", // 1583177
"ts,tsonga",
"tt,tatar",
"tw,twi",
"ty,tahitian",
"ug,uighur",
"uk,ukrainian",
"ur,urdu",
"uz,uzbek",
"ve,venda",
"vi,vietnamese",
"vo,volapük",
"wa,walloon",
"wen,sorbian",
"wo,wolof",
"xh,xhosa",
"yi,yiddish",
"yo,yoruba",
"za,zhuang",
"zam,miahuatlán zapotec",
"zh,chinese",
"zh-cn,chinese china",
"zh-Hans,chinese simple",
"zh-Hant,chinese traditional",
"zh-hk,chinese hong kong",
"zh-sg,chinese singapore",
"zh-tw,chinese taiwan",
"zu,zulu",
]

var legendclean = [],
	locales = [],
	summary = [],
	isDayPeriodSupported = false

function legend() {
	// build once
	if (legendclean.length == 0) {
		detailed.sort()
		for (let i = 0 ; i < detailed.length; i++) {
			let code = detailed[i].split(",")[0]
			let name = detailed[i].split(",")[1]
			code = code.trim()
			locales.push(code.toLowerCase())
			legendclean.push(code.padStart(7) +": "+ name)
		}
	}
	// output
	dom.legend.innerHTML = s4 +"   LEGEND ("+ legendclean.length +")"+ sc +"<br><br>"+ legendclean.join("<br>")
}

function get_dayperiod(date, code, option) {
	return new Intl.DateTimeFormat(code, {hourCycle: "h12", dayPeriod: option}).format(date)
}

function run_main(method) {
	let t0 = performance.now()
	let data = [], aSupported = []
	let spacer = "<br><br>"
	let isAll = false
	if (method == "all") {isAll = true; method = "narrow"}
	let useSupportedOnly = dom.supported.checked

	try {
		locales.forEach(function(code) {
			// only if locale is supported
			let go = true
			if (useSupportedOnly) {
				let test = Intl.PluralRules.supportedLocalesOf([code])
				if (test.length) {aSupported.push(code)} else {go = false}
			}
			if (go) {
				let str ="", str2 = "", str3 = ""
				// in the morning, noon, in the afternoon, in the evening, at night
				str = get_dayperiod(new Date("2019-01-30T08:00:00"), code, method)
					+", "+ get_dayperiod(new Date("2019-01-30T12:00:00"), code, method)
					+", "+ get_dayperiod(new Date("2019-01-30T15:00:00"), code, method)
					+", "+ get_dayperiod(new Date("2019-01-30T18:00:00"), code, method)
					+", "+ get_dayperiod(new Date("2019-01-30T22:00:00"), code, method)
				if (!isAll) {
					data.push(sha1(str) +"~~~"+ code +"~~~" + str)
				} else {
					str2 = get_dayperiod(new Date("2019-01-30T08:00:00"), code, "short")
						+", "+ get_dayperiod(new Date("2019-01-30T12:00:00"), code, "short")
						+", "+ get_dayperiod(new Date("2019-01-30T15:00:00"), code, "short")
						+", "+ get_dayperiod(new Date("2019-01-30T18:00:00"), code, "short")
						+", "+ get_dayperiod(new Date("2019-01-30T22:00:00"), code, "short")
					str3 = get_dayperiod(new Date("2019-01-30T08:00:00"), code, "long")
						+", "+ get_dayperiod(new Date("2019-01-30T12:00:00"), code, "long")
						+", "+ get_dayperiod(new Date("2019-01-30T15:00:00"), code, "long")
						+", "+ get_dayperiod(new Date("2019-01-30T18:00:00"), code, "long")
						+", "+ get_dayperiod(new Date("2019-01-30T22:00:00"), code, "long")
					data.push(sha1(str +", "+ str2 +", "+ str3) +"~~~"+ code +"~~~"+ str +"~~~"+ str2 +"~~~"+ str3)
				}
			}
		})

		// get one line per hash
		data.sort()
		//console.debug(data)
		let next = "", codes = []
		let aHash = [], aBuckets = []
		for (let i = 0 ; i < data.length; i++) {
			// get current item
			let parts = data[i].split("~~~")
			let tmpH = parts[0] // hash
			let tmpC = parts[1] // code
			let tmpN = parts[2] // narrow (or the one tested)
			let tmpS = parts[3] // short
			let tmpL = parts[4] // long
			codes.push(tmpC)
			// grab next item
			if (i < data.length - 1) {
				next = data[(i+1)].split("~~~")[0]
			} else {
				next = "end"
			}
			// build new item
			if (next !== tmpH) {
				aBuckets.push(codes.join())
				let str = s12 + tmpH + sc + s4 + " ["+ codes.length +"]"+ sc
				if (isAll) {
					str += "<ul><li>"+ s12 +"N: "+ sc + tmpN +"</li>"
						+ "<li>"+ s12 +"S: "+ sc + tmpS +"</li>"
						+ "<li>"+ s12 +"L: "+ sc + tmpL +"</li>"
				} else {
					str += "<ul><li>"+ tmpN +"</li>"
				}
				str += "<li>"+ codes.join(", ") +"</li></ul>"
				aHash.push(str)
				codes = [] // reset
			}
		}
		// buckets
		aBuckets.sort()
		//console.debug(aBuckets.join("\n"))
		let bHash = sha1(aBuckets.join())

		// display
		if (isAll) {method = "all"}
		dom.results.innerHTML = s4 + method.toUpperCase() +": " + sc + bHash
			+ s4 +" ["+ aBuckets.length + (useSupportedOnly ? "|"+ aSupported.length : "") +"]" + sc
			+ spacer +"<br>"+ aHash.join("<br>")
		// perf
		let t1 = performance.now()
		dom.perf.innerHTML = Math.round(t1-t0) +"ms"

	} catch(e) {
		dom.results.innerHTML = "<br>"+ s4 + e.name +": "+ sc + e.message
	}
}

function run(method) {
	if (isDayPeriodSupported) {
		//reset
		legend()
		dom.results = "running test..."
		dom.perf = ""
		setBtn(method)
		// delay so users see change and allow paint
		setTimeout(function() {
			run_main(method)
		}, 1)
	}
}

function run_test() {
	let A = get_dayperiod(new Date("2019-01-30T08:00:00"), "en", "long")
	let B = get_dayperiod(new Date("2019-01-30T12:00:00"), "en", "long")
	if (A == B) {
		isDayPeriodSupported = false
		dom.results.innerHTML = s4 + "dayPeriod: " + sc + zNS
	} else {
		isDayPeriodSupported = true
		setBtn("all")
		dom.results = "running test..."
		setTimeout(function() {
			run_main("all")
		}, 100)
	}
}

function setBtn(method) {
	// reset btns
	let items = document.getElementsByClassName("btn8")
	for (let i=0; i < items.length; i++) {
		items[i].classList.add("btn4")
		items[i].classList.remove("btn8")
	}
	// set btn
	let el = document.getElementById("b"+ method)
	el.classList.add("btn8")
	el.classList.remove("btn4")
}

function start() {
	s4 = s4.trim()
	s12 = s12.trim(),
	s14 = s14.trim(),
	s16 = s16.trim(),
	sg = sg.trim()
	sb = sb.trim()
	dom.supported.checked = true
	legend()
	run_test()
}

start()


</script>
</body>
</html>
