<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="scripts">
	<title>scripts</title>
	<link rel="stylesheet" type="text/css" href="testindex.css">
	<script src="testglobals.js"></script>
	<script src="testgeneric.js"></script>
	<style>
		table {width: 90%; min-width: 600px; max-width: 1600px}
		hr {color: var(--test12);}
		ul.nomargin {padding-left: 0;}
		#ugSpan {font-size: 10000%;}
		a.sb {color: #dc8c8c;}
		.groupleft {float: left;}
		.groupright {float: right;}
		.script {line-height: 2.4; font-family: monospace, "Courier New";}
		nav {
			position: absolute;
			padding: 15px;
			background-color: #161b22;
		}
		nav div {
			white-space: nowrap;
			margin-bottom: 12px;
		}
		code.purple {
			background-color: rgba(150, 100, 240, 0.4) !important;
			padding-left: 2px !important;
			padding-right: 2px !important;
			color: #dcdcdc;
			font-size: 11px;
		}
		div.chars {
			direction:ltr;
			unicode-bidi:bidi-override;
		}
	</style>
</head>

<body>
	<div class="offscreen">
		<div id="ugDiv" class="normalized" style='font-size: 22pt;'><span id="ugSpan"><span id="ugSlot"></span></span></div>
	</div>

	<table>
	<tr><td><h2>TorZillaPrint</h2></td></tr>
	<tr><td class="blurb"><a class="return" href="../index.html">return to TZP index</a></td></tr>
	</table>

	<table id="tb12">
		<col width="20%"><col width="80%">
		<thead><tr><th colspan="2">
			<div class="nav-title">scripts
			<div class="nav-up"><span class="c perf" id="perf">waiting on reflow ...</span></div>
			<div class="nav-down"><span class="c perf" id="tofuSize"></span></div></div>
			</div>
		</th></tr></thead>
		<tr><td colspan="2" class="intro">
			<span class="no_color">Tests font vis vs script support by checking up to
				<code>x</code> characters per script for matching tofu sizes. Allow 2-3 secs before testing to ensure
				<a target="_blank" class="blue" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1676966#c54">asynchronous font fallback</a>.
				Tofu results are colored coded as <span class="bad">80+%</span>, <span class="s2">20-80%</span>, <span class="s4">20% or lower</span>.
				NOTE: <span class="s14">[RANGES...]</span> used can be <code class="purple">P</code> partial and/or <code class="purple">S</code>
				selective [uses some blocks in that range]. TIP: Click script names in the display to logs code points to console.
			</span>
		</td></tr>
		<tr>
			<td style="text-align: left; vertical-align: bottom;">
				<span id="toggleScript" class="btn12 btnfirst" onClick="toggleitem(`legend`)">&#9660 index</span> <span id="countScript"></span>
			</td>
			<td style="text-align: left; vertical-align: bottom;">
				<span class="btn12 btnfirst" onClick="run('test')">[ run ]</span>
				<span class="btn12 btn" onClick="toggleitem(`navmenu`)" style="position: relative;">
					[ list &#9660 ]
					<nav id="navmenu" class="hidden" style="cursor: auto;">
						<span class="no_color" style="font-size: 11px;">logs to console<br><br></span>
						<span style="cursor: pointer;">
						<div onClick="logConsole('rangesreduced')">ranges [reduced]</div>
						<div onClick="logConsole('ranges')">ranges [used]</div>
						<div onClick="logConsole('reserved')">code points [reserved]</div>
						<div onClick="logConsole('ignore')">code points [ignored]</div>
						<div onClick="logConsole('max')">code points [max used]</div>
						<div onClick="logConsole('reduce')">code points [reduce]</div>
						<div onClick="logConsole('min')">code points [min used]</div>
						<div onClick="logConsole('version')">unicode [min versions]</div>
						<div onClick="logConsole('wiki')">wiki links</div>
						<div onClick="logConsole('everything')">everything</div>
						</span>
					</nav>
				</span>
				<span class="s12 mono" onClick='reset(true, false)'> depth
					<input type="radio" name="depth" value=20 checked> 20
					<input type="radio" name="depth" value=50> 50
					<input type="radio" name="depth" value="ALL"> ALL
				</span> | &nbsp
				<span class="s12 mono">
					<input type="checkbox" name="allassigned" style="margin: 0; height: 12px" onClick='reset()'> max
					<div class="ttip"><span class="icon">[ i ]</span>
						<span class="ttxtb" style="font-style: normal; font-family: serif;">
						<br>When unchecked, some scripts<br>will use earlier unicode versions<br>
						<br>e.g. Armenian will use <b>v3.0</b> (1999)
						<br>ignoring <b>U+058F</b> (v6.1, 2012)<br><b>U+058D, U+058E</b> (v7.0, 2014)<br><b>U+0560, U+0588</b> (v11.0, 2018)<br>
						<br>Reduces tofu noise on platforms<br>with older font versions e.g. if<br>just checking basic script support<br><br></span>
					</div>
				</span>
			</td>
		</tr>
		<tr><td colspan="2"><hr></td></tr>
		<tr>
			<td style="text-align: left; vertical-align: top;">
				<span class="mono spaces hidden" id="legend" style="color: #b3b3b3; font-size: 11px;"></span>
				<span class="mono spaces" id="summary" style="color: #b3b3b3; font-size: 11px;"></span>
			</td>
			<td style="text-align: left; vertical-align: top;">
				<span class="spaces" style="direction:ltr;unicode-bidi:bidi-override; font-size: 12px;" id="visual">
					<br>waiting on reflow ...
				</span>
			</td></tr>
	</table>
	<br>

<script>
'use strict';
// https://en.wikipedia.org/wiki/List_of_Unicode_characters
// https://www.cogsci.ed.ac.uk/~richard/unicode-sample-3-2.html

let aPartial = [
	// partial range: i.e start..end is not the full assigned range

	"arabic presentation forms-a", // 631 code points: too much to reduce and ignore
	"basic latin", // C0 controls ignored
	"general punctuation", // 200x and 206x ignored, e.g. birectional, non-printing etc
	"latin-1 supplement", // 008x + 009x ignored, control codes
	"mathematical alphanumeric symbols", // 996 code points

	// partial: reduce entropy duplicity
		// i.e a lot of chars are the same measurements: east asian languages
	"cjk radicals supplement",
	"enclosed cjk letters and months",
	"hangul compatibility jamo",
	"hangul jamo",
	"kangxi radicals",
	"hiragana",
	"katakana",

	// partial! doh! way too big
		// also east asian measurments seem to all be the same per script
	"cjk unified ideographs", // 20,992 code points
	"cjk unified ideographs extension-a", // 6,592 code points
	"cjk unified ideographs extension-b", // 42,720 code points
	"hangul syllables", // 11,172 code points
	"yi syllables",  // 1,165 code points
]

let aSelective = [
	// not all blocks in the range is used: i.e not "contiguous"
		// be careful to not exclude later assigned code points
		// or reduce size entropy per script
	"enclosed cjk letters and months",
	"hangul jamo",
]

let aSpacer = [
	"combining diacritical marks",
	"combining diacritical marks for symbols",
	"combining diacritical marks supplement",
	"cyrillic extended-a",
]

let oEnlarge = {
	"alphabetic presentation forms": [14],
	"arabic": [16],
	"arabic presentation forms-a": [16],
	"arabic supplement": [16],
	"arrows": [14],
	"bengali": [14],
	"bopomofo extended": [14],
	"combining diacritical marks": [20],
	"combining diacritical marks for symbmols": [20],
	"combining diacritical marks supplement": [20],
	"control pictures": [16],
	"cyrillic extended-a": [22],
	"deseret": [14],
	"devanagari": [14],
	"ethiopic": [14],
	"ethiopic supplement": [16],
	"general punctuation": [16],
	"glagolitic": [14],
	"hangul jamo": [14],
	"hebrew": [18],
	"ipa extensions": [14],
	"kanbun": [16],
	"katakana phonetic extensions": [16],
	"mongolian": [20],
	"ogham": [18],
	"old turkic": [14],
	"optical character recognition": [18],
	"oriya": [14],
	"phonetic extensions": [16],
	"phonetic extensions supplement": [16],
	"runic": [14],
	"sinhala": [16],
	"spacing modifier letters": [18],
	"superscripts and subscripts": [18],
	"supplemental arrows-a": [14],
	"supplemental arrows-b": [14],
	"syriac": [16],
	"tai le": [14],
	"telugu": [16],
	"thai": [14],
	"thanaa": [16],
	"tibetan": [18],
	"vertical forms": [16],
	"yi syllables": [16],
}

let	uv1x0x0 = "1.0.0 (1991)",
	uv1x0x1 = "1.0.1 (1992)",
	uv1x1 = "1.1 (1993)",
	uv2x0 = "2.0 (1996)",
	uv3x0 = "3.0 (1999)",
	uv3x1 = "3.1 (2001)",
	uv3x2 = "3.2 (2002)",
	uv4x0 = "4.0 (2003)",
	uv4x1 = "4.1 (2005)",
	uv5x0 = "5.0 (2006)",
	uv5x1 = "5.1 (2008)",
	uv9x0 = "9.0 (2016)"

let aBlocks = [
	// note: first item needs to be a group name for the top anchor to work

	// schema:
	// name, prefix, [block range], remove last x, [reserved], url, [reduce], reduced-version, [ignore]

	// AFRICAN
	["african"],
	["adlam", "1E9", [0,1,2,3,4,5], 0, ["4C","4D","4E","4F","5A","5B","5C","5D"], "Adlam_(Unicode_block)",
		[
			"4B", // 12.0
		], uv9x0
	],
	["bamum", "A6", ["A","B","C","D","E","F"], -8, , "Bamum_(Unicode_block)"],
	["bassa vah", "16A", ["D","E","F"], -10, ["EE","EF"], "Bassa_Vah_(Unicode_block)"],
	["ethiopic", 1, [20,21,22,23,24,25,26,27,28,29,"2A","2B","2C","2D","2E","2F",30,31,32,33,34,35,36,37], -3,
		["249","24E","24F","257","259","25E","25F","289","28E","28F","2B1","2B6","2B7","2BF",
		"2C1","2C6","2C7","2D7","311","316","317","35B","35C"], "Ethiopic_(Unicode_block)",
		[
			"35D","35E", // 6.0
		], uv4x1
	],
	["ethiopic supplement", "13", [8,9], -6, , "Ethiopic_Supplement"],
	//["medefaidrin", "16E", [4,5,6,7,8,9], -5, , "Medefaidrin_(Unicode_block)"], // noone supports this, reduce overhead/perf
	["nko", "07", ["C","D","E","F"], 0, ["FB","FC"], "NKo_(Unicode_block)",
		[
			"FD","FE","FF", // 11.0
		], uv5x0
	],
	["osmanya", "104", [8,9,"A"], -6, ["9E","9F"], "Osmanya_(Unicode_block)"],
	["tifinagh", "2D", [3,4,5,6,7], 0,
		["68","69","6A","6B","6C","6D","6E","71","72","73","74","75","76","77","78","79","7A","7B","7C","7D","7E"],
		"Tifinagh_(Unicode_block)",
		[
			"70", // 6.0
			"66","67", // 6.1
		], uv4x1,
		["7F"] // ignore: tifinagh consonant joiner
	],
	["vai", "A", [50,51,52,53,54,55,56,57,58,59,"5A","5B","5C","5D","5E","5F",60,61,62,63], -20, , "Vai_(Unicode_block)"],

	// AMERICAN
	["american"],
	["cherokee", 13, ["A","B","C","D","E","F",], -2, ["F6","F7"], "Cherokee_(Unicode_block)",
		[
			"F5","F8","F9","FA","FB","FC","FD", // 8.0
		], uv3x0
	],
	["deseret", "104", [0,1,2,3,4], , , "Deseret_(Unicode_block)"],
	["osage", "104", ["B","C","D","E","F"], -4, ["D4","D5","D6","D7"], "Osage_(Unicode_block)"],
	["unified canadian aboriginal syllabics", 1,
		[40,41,42,43,44,45,46,47,48,49,"4A","4B","4C","4D","4E","4F",
		50,51,52,53,54,55,56,57,58,59,"5A","5B","5C","5D","5E","5F",
		60,61,62,63,64,65,66,67], , , "Unified_Canadian_Aboriginal_Syllabics_(Unicode_block)",
		[
			"400","677","678","679","67A","67B","67C","67D","67E","67F", // 5.2
		], uv3x0
	],

	// ANCIENT
	["ancient and historic"],
	["gothic", 103, [3,4], -5, , "Gothic_(Unicode_block)"],
	["ogham", 16, [8,9], -3, , "Ogham_(Unicode_block)"],
	["old italic", 103, [0,1,2], ,
		["24","25","26","27","28","29","2A","2B","2C"], "Old_Italic_(Unicode_block)",
		[
			"1F", // 7.0
			"2D","2E","2F" // 10.0
		], uv3x1
	],
	["old turkic", "10C", [0,1,2,3,4], -7, , "Old_Turkic_(Unicode_block)"],
	["runic", 16, ["A","B","C","D","E","F"], -7, , "Runic_(Unicode_block)",
		[
			"F1","F2","F3","F4","F5","F6","F7","F8",  // 7.0
		], uv3x0
	],

	// BRAHMIC
	["brahmic"],
	["balinese", "1B", [0,1,2,3,4,5,6,7], -1, ["4D","4E","4F"], "Balinese_(Unicode_block)",
		[
			"4C","7D","7E" // 14.0
		], uv5x0
	],
	["bengali", "09", [8,9,"A","B","C","D","E","F"], -1,
		["84","8D","8E","91","92","A9","B1","B3","B4","B5","BA","BB","C5","C6","C9","CA","CF",
		"D0","D1","D2","D3","D4","D5","D6","D8","D9","DA","DB","DE","E4","E5"], "Bengali_(Unicode_block)",
		[
			"FB", // 5.2
			"80", // 7.0
			"FC","FD", // 10.0
			"FE", // 11.0
		], uv4x1
	],
	["buginese", "1A", [0,1], 0, ["1C","1D"], "Buginese_(Unicode_block)"],
	["buhid", 17, [4,5,], -12, , "Buhid_(Unicode_block)"],
	["devanagari", "09", [0,1,2,3,4,5,6,7], , , "Devanagari_(Unicode_block)",
		[
			"71","72", // 5.1
			"00","4E","55","79","7A", // 5.2
			"3A","3B","4F","56","57","73","74","75","76","77", // 6.0
			"78" // 7.0
		], uv5x0
	],
	["gujarati", "0A", [8,9,"A","B","C","D","E","F"], 0,
		["80","84","8E","92","A9","B1","B4","BA","BB","C6","CA","CE","CF",
		"D1","D2","D3","D4","D5","D6","D7","D8","D9","DA","DB","DC","DD","DE","DF",
		"E4","E5","F2","F3","F4","F5","F6","F7","F8"],
		"Gujarati_(Unicode_block)",
		[
			"F0", // 6.1
			"F9", // 8.0
			"FA","FB","FC","FD","FE","FF", // 10.0
		], uv4x0
	],
	["gurmukhi", "0A", [0,1,2,3,4,5,6,7], -9,
		["00","04","0B","0C","0D","0E","11","12","29","31","34","37","3A","3B","3D",
		"43","44","45","46","49","4A","4E","4F","50","52","53","54","55","56","57","58",
		"5D","5F","60","61","62","63","64","65"], "Gurmukhi_(Unicode_block)",
		[
			"51","75", // 5.1
			"76", // 11.0
		], uv4x0
	],
	["hanunoo", 17, [2,3], -9, , "Hanunoo_(Unicode_block)"],
	["javanese", "A9", [8,9,"A","B","C","D"], 0, ["CE","DA","DB","DC","DD"], "Javanese_(Unicode_block)"],
	["kannada", "0C", [8,9,"A","B","C","D","E","F"], -13,
		["8D","91","A9","B4","BA","BB","C5","C9","CE","CF",
		"D0","D1","D2","D3","D4","D7","D8","D9","DA","DB","DC","DF","E4","E5","F0"],
		"Kannada_(Unicode_block)",
		[
			"81", // 7.0
			"80", // 9.0
			"84", // 11.0
			"DD", // 14.0
		], uv5x0
	],
	["khmer", 17, [8,9,"A","B","C","D","E","F"], -6,
		["DE","DF","EA","EB","EC","ED","EE","EF"], "Khmer_(Unicode_block)", , ,
		["B4","B5"] // ignore: KIV AQ, KIV AA
	],
	["khmer symbols", 19, ["E","F"], , , "Khmer_Symbols"],
	["lao", "0E", [8,9,"A","B","C","D","E","F"], -32,
		["80","83","85","8B","A4","A6","BE","BF","C5","C7","CE","CF","DA","DB"],
		"Lao_(Unicode_block)",
		[
			"DE","DF", // 6.1
			"86","89","8C","8E","8F","90","91","92","93","98","A0","A8","A9","AC","BA", // 12.0
		], uv1x0x1
	],
	["malayalam", "0D", [0,1,2,3,4,5,6,7], 0,
		["0D","11","45","49","50","51","52","53","64","65"],
		"Malayalam_(Unicode_block)",
		[
			"29","3A","4E", // 6.0
			"01", // 7.0
			"5F", // 8.0
			"4F","54","55","56","58","59","5A","5B","5C","5D","5E","76","77","78", // 9.0
			"00","3B","3C", // 10.0
			"04", // 13.0
		], uv5x1,
		["4E"] // ignore: letter dot reph
	],
	["modi", 116, [0,1,2,3,4,5], -6, ["45","46","47","48","49","4A","4B","4C","4D","4E","4F"], "Modi_(Unicode_block)",],
	["myanmar", 10, [0,1,2,3,4,5,6,7,8,9], 0, , "Myanmar_(Unicode_block)",
		[
			"9A","9B","9C","9D", // 5.2
		], uv5x1
	],
	["new tai lue", 19, [8,9,"A","B","C","D"], 0,
		["AC","AD","AE","AF","CA","CB","CC","CD","CE","CF","DB","DC","DD"],
		"New_Tai_Lue_(Unicode_block)",
		[
			"AA","AB","DA", // 5.2
		], uv4x1
	],
	["oriya", "0B", [0,1,2,3,4,5,6,7], -8,
		["00","04","0D","0E","11","12","29","31","34","3A","3B","45","46","49","4A","4E","4F",
		"50","51","52","53","54","58","59","5A","5B","5E","64","65"],
		"Oriya_(Unicode_block)",
		[
			"72","73","74","75","76","77", // 6.0
			"55", // 13.0
		], uv5x1
	],
	["phags-pa", "A8", [4,5,6,7], -8, , "Phags-pa_(Unicode_block)"],
	["sinhala", "0D", [8,9,"A","B","C","D","E","F"], -11,
		["80","84","97","98","99","B2","BC","BE","BF","C7","C8","C9","CB","CC","CD","CE","D5","D7",
		"E0","E1","E2","E3","E4","E5","F0","F1"],
		"Sinhala_(Unicode_block)",
		[
			"E6","E7","E8","E9","EA","EB","EC","ED","EE","EF", // 7.0
			"81", // 13.0
		], uv3x0
	],
	["sundanese", "1B", [8,9,"A","B"], , ,
		"Sundanese_(Unicode_block)",
		[
			"AB","AC","AD","BA","BB","BC","BD","BE","BF", // 6.1
		], uv5x1,
		["AB"] // ignore: sign virama
	],
	["tagalog", 17, [0,1,], 0, ["16","17","18","19","1A","1B","1C","1D","1E"],
		"Tagalog_(Unicode_block)",
		[
			"0D","15","1F" // 14.0
		], uv3x2
	],
	["tagbanwa", 17, [6,7], -12, ["6D","71"], "Tagbanwa_(Unicode_block)"],
	["tai le", 19, [5,6,7], -11, ["6E","6F"], "Tai_Le_(Unicode_block)"],
	["tamil", "0B", [8,9,"A","B","C","D","E","F"], -5,
		["80","81","84","8B","8C","8D","91","96","97","98","9B","9D",
		"A0","A1","A2","A5","A6","A7","AB","AC","AD","BA","BB","BC","BD",
		"C3","C4","C5","C9","CE","CF",
		"D1","D2","D3","D4","D5","D6","D8","D9","DA","DB","DC","DD","DE","DF",
		"E0","E1","E2","E3","E4","E5"], "Tamil_(Unicode_block)"
	],
	["tamil supplement", "11F", ["C","D","E","F"], 0,
		["F2","F3","F4","F5","F6","F7","F8","F9","FA","FB","FC","FD","FE"], "Tamil_Supplement"
	],
	["telugu", "0C", [0,1,2,3,4,5,6,7], 0,
		["0D","11","29","3A","3B","45","49","4E","4F",
		"50","51","52","53","54","57","5B","5C","5E","5F",
		"64","65","70","71","72","73","74","75","76"], "Telugu_(Unicode_block)",
		[
			"00","34", // 7.0
			"5A", // 8.0
			"04", // 11.0
			"77", // 12.0
			"3C","5D", // 14.0
		], uv5x1
	],
	["thai", "0E", [0,1,2,3,4,5,6,7], -36, ["00","3B","3C","3D","3E"], "Thai_(Unicode_block)"],
	["tibetan", "0F", [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], -37,
		["48","6D","6E","6F","70","98","BD","CD"],
		"Tibetan_(Unicode_block)",
		[
			"D0","D1", // 4.1
			"6B","6C","CE","D2","D3","D4", // 5.1
			"D5","D6","D7","D8", // 5.2
			"8C","8D","8E","8F","D9","DA", // 6.0
		], uv3x0,
		["0C"] // ignore: mark delimiter tsheg bstar
	],

	// CYRILLIC
	["cyrillic"],
	["cyrillic", "04", [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], , ,
		"Cyrillic_(Unicode_block)",
		[
			"CF","FA","FB","FC","FD","FE","FF", // 5.0
			"87", // 5.1
		], uv4x1
	],
	["cyrillic extended-a", "2D", ["E","F"], , , "Cyrillic_Extended-A"],
	["cyrillic extended-b", "A6", [4,5,6,7,8,9], , ,
		"Cyrillic_Extended-B",
		[
			"60","61", // 6.0
			"74","75","76","77","78","79","7A","7B","9F", // 6.1
			"98","99","9A","9B","9C","9D", // 7.0
			"9E", // 8.0
		], uv5x1
	],
	["cyrillic extended-c", "1C", [8], -7, , "Cyrillic_Extended-C"],
	["cyrillic supplement", "05", [0,1,2], , ,
		"Cyrillic_Supplement",
		[
			"14","15","16","17","18","19","1A","1B","1C","1D","1E","1F","20","21","22","23", // 5.1
			"24","25", // 5.2
			"26","27", // 6.0
			"28","29","2A","2B","2C","2D","2E","2F", // 7.0
		], uv5x0
	],
	["glagolitic", "2C", [0,1,2,3,4,5], , , "Glagolitic_(Unicode_block)",
		[
			"2F","5F" // 14.0
		], uv4x1
	],

	// EAST ASIAN
	["east asian"],
	["bopomofo", 31, [0,1,2], 0, ["00","01","02","03","04"], "Bopomofo_(Unicode_block)",
		[
			"2D", // 5.1
			"2E", // 10.0
			"2F", // 11.0
		], uv1x0x0
	],
	["bopomofo extended", 31, ["A","B"], , , "Bopomofo_Extended",
		[
			"B8","B9","BA", // 6.0
			"BB","BC","BD","BE","BF", // 13.0
		], uv3x0
	],
	["cjk compatibility", 33, [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], , ,
		"CJK_Compatibility",
		[
			"77","78","79","7A","DE","DF","FF", // 4.0
		], uv1x1
	],
	["cjk compatibility forms", "FE", [3,4], , , "CJK_Compatibility_Forms"],
	["cjk compatibility ideographs", "F",
		[90,91,92,93,94,95,96,97,98,99,"9A","9B","9C","9D","9E","9F",
		"A0","A1","A2","A3","A4","A5","A6","A7","A8","A9","AA","AB","AC","AD","AE","AF"], -38, ["A6E","A6F"],
		"CJK_Compatibility_Ideographs",
		[
			"A6B","A6C","A6D", // 5.2
			"A2E","A2F", // 6.1
		], uv4x1
	],
	["cjk compatibility ideographs supplement", "2F",
		[80,81,82,83,84,85,86,87,88,89,"8A","8B","8C","8D","8E","8F",
			90,91,92,93,94,95,96,97,98,"9A","9B","9C","9D","9E","9F","A0","A1"
		], -2, ,
		"CJK_Compatibility_Ideographs_Supplement"
	],
	["cjk symbols and punctuation", 30, [0,1,2,3], , , "CJK_Symbols_and_Punctuation", , ,
		["00"] // ignore: ID SP
	],
	["cjk radicals supplement", "2E", [8,9,"A","B"], , ["9A"], "CJK_Radicals_Supplement"],
		// ["cjk radicals supplement", "2E", [8,9,"A","B","C","D","E","F"], -12, ["9A"], "CJK_Radicals_Supplement"], // full

	["cjk unified ideographs", "4E", [0,1,2,3], , , "CJK_Unified_Ideographs_(Unicode_block)"],
	["cjk unified ideographs extension-a", 34, [0,1,2,3], , , "CJK_Unified_Ideographs_Extension_A"],
	["cjk unified ideographs extension-b", 200, [0,1,2,3], , , "CJK_Unified_Ideographs_Extension_B"],

	["enclosed cjk letters and months", "32", [1,2,4,5,7,"A","C","F"], , ["1F"], // 2,A adds size entropy for this script
		//["enclosed cjk letters and months", "32", [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], , ["1F"], // full
		"Enclosed_CJK_Letters_and_Months",
		[
			"1D","1E","50","7C","7D","CC","CD","CE","CF", // 4.0
			"7E", // 4.1
			"44","45","46","47","48","49","4A","4B","4C","4D","4E","4F", // 5.2
			"FF", // 12.1
		], uv3x2
	],
	["hangul compatibility jamo", 31, [3,4,5,6], , ["30","8F"], "Hangul_Compatibility_Jamo", , ,
		// ["hangul compatibility jamo", 31, [3,4,5,6,7,8], , ["30"], "Hangul_Compatibility_Jamo", , , // full
		["64"] // ignore: HF
	],
	["hangul jamo", 11, [5,"A","B","F"], , , "Hangul_Jamo_(Unicode_block)",
		// ["hangul jamo", 11, [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], , , "Hangul_Jamo_(Unicode_block)", // full
		[
			"5A","5B","5C","5D","5E","A3","A4","A5","A6","A7","FA","FB","FC","FD","FE","FF", // 5.2
		], uv1x1,
		["5F","60"] // ignore: HCF hangul choseong filler, HJF hangul jungseong filler
	],
	["hangul syllables", "AC", [0,1,2,3], , , "Hangul_Syllables"],

	["hiragana", 30, [6,7,8,9], , ["97","98"], "Hiragana_(Unicode_block)"],
	// ["hiragana", 30, [4,5,6,7,8,9], , ["40","97","98"], "Hiragana_(Unicode_block)"], // full

	["ideographic description characters", "2F", ["F"], -4, , "Ideographic_Description_Characters_(Unicode_block)"],
	["kanbun", 31, [9], , , "Kanbun_(Unicode_block)"],
	["kangxi radicals", "2F", [0,1,2,3], , , "Kangxi_Radicals_(Unicode_block)"],
		// ["kangxi radicals", "2F", [0,1,2,3,4,5,6,7,8,9,"A","B","C","D"], -10, , "Kangxi_Radicals_(Unicode_block)"], // full

	["katakana", 30, ["A","B","C","D"], , , "Katakana_(Unicode_block)"],
	// ["katakana", 30, ["A","B","C","D","E","F"], , , "Katakana_(Unicode_block)"], // full

	["katakana phonetic extensions", 31, ["F"], , , "Katakana_Phonetic_Extensions"],
	["vertical forms", "FE", [1], -6, , "Vertical_Forms"],
	["yi radicals", "A4", [9,"A","B","C"], -9, , "Yi_Radicals"],
	["yi syllables", "A0", [0,1,2,3], , , "Yi_Syllables"],

	// GEORGIAN
	["georgian"],
	["georgian", 10, ["A","B","C","D","E","F"], ,
		["C6","C8","C9","CA","CB","CC","CE","CF"], "Georgian_(Unicode_block)",
		[
			"C7","CD","FD","FE","FF", // 6.1
		], uv4x1
	],
	["georgian extended", "1C", [9,"A","B"], , ["BB","BC"], "Georgian_Extended"],
	["georgian supplement", "2D", [0,1,2], -2, ["26","28","29","2A","2B","2C"],
		"Georgian_Supplement",
		[
			"27","2D" // 6.1
		], uv4x1
	],

	// GREEK
	["greek"],
	["greek and coptic", "03", [7,8,9,"A","B","C","D","E","F"], ,
		["78","79","80","81","82","83","8B","8D","A2"], "Greek_and_Coptic",
		[
			"70","71","72","73","76","77","CF", // 5.1
			"7F", // 7.0
		], uv5x0
	],
	["greek extended", "1F", [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], -1,
		["16","17","1E","1F","46","47","4E","4F","58","5A","5C","5E","7E","7F","B5","C5","D4","D5","DC","F0","F1","F5"],
		"Greek_Extended"
	],

	// LATIN
	["latin"],
	["basic latin", "00", [2,3,4,5,6,7], , , "Basic_Latin_(Unicode_block)", , ,
		["20","7F"] // ignore: SP, DEL
	],
	["latin-1 supplement", "00", ["A","B","C","D","E","F"], , , "Latin-1_Supplement", , ,
		["A0","AD"], // ignore: NBSP, SHY
	],
	["latin extended-a", "01", [0,1,2,3,4,5,6,7], , , "Latin_Extended-A"],
	["latin extended-b", 0, [18,19,"1A","1B","1C","1D","1E","1F", 20, 21,22,23,24], , , "Latin_Extended-B"],
	["latin extended additional", "1E", [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], , ,
		"Latin_Extended_Additional",
		[
			"9C","9D","9E","9F","FA","FB","FC","FD","FE","FF", // 5.1
		], uv2x0
	],

	// PHONETIC
	["phonetic"],
	["ipa extensions", "02", [5,6,7,8,9,"A"], , , "IPA_Extensions"],
	["phonetic extensions", "1D", [0,1,2,3,4,5,6,7], , , "Phonetic_Extensions"],
	["phonetic extensions supplement", "1D", [8,9,"A","B"], , , "Phonetic_Extensions_Supplement"],
	["spacing modifier letters", "02", ["B","C","D","E","F"], , , "Spacing_Modifier_Letters"],

	// SEMITIC
	["semitic"],
	["arabic", "06", [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], , , "Arabic_(Unicode_block)",
		[
			"20","5F", // 6.0
			"04", // 6.1
			"1C", // 6.3
			"05", // 7.0
			"1D", // 14.0
		], uv5x1,
		["1C"] // ALM
	],
	["arabic presentation forms-a", "FB", [5,6,7,8,9,"A"], , , "Arabic_Presentation_Forms-A"],
	["arabic supplement", "07", [5,6,7], , , "Arabic_Supplement",
		[
			"6E","6F","70","71","72","73","74","75","76","77","78","79","7A","7B","7C","7D","7E","7F", // 5.1
		], uv4x1
	],
	["hebrew", "05", [9,"A","B","C","D","E","F"], -11,
		["90","C8","C9","CA","CB","CC","CD","CE","CF","EB","EC","ED","EE"],
		"Hebrew_(Unicode_block)",
		[
			"EF", // 11.0
		], uv5x0
	],
	["mandaic", "08", [4,5], -1, ["5C","5D"], "Mandaic_(Unicode_block)"],
	["samaritan", "08", [0,1,2,3], -1, ["2E","2F"], "Samaritan_(Unicode_block)"],
	["syriac", "07", [0,1,2,3,4], 0, ["0E","4B","4C"], "Syriac_(Unicode_block)"],

	// symbols
	["symbols"],
	["alphabetic presentation forms", "FB", [0,1,2,3,4], ,
		["07","08","09","0A","0B","0C","0D","0E","0F","10","11","12","18","19","1A","1B","1C","37","3D","3F","42","45"],
		"Alphabetic_Presentation_Forms"
	],
	["arrows", 21, [9,"A","B","C","D","E","F"], , , "Arrows_(Unicode_block)"],
	["block elements", 25, [8,9], , , "Block_Elements"],
	["box drawing", 25, [0,1,2,3,4,5,6,7], , , "Box_Drawing"],
	["braille patterns", 28, [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], , ,"Braille_Patterns"],
	["currency symbols", 20, ["A","B","C"], -15, , "Currency_Symbols_(Unicode_block)",
		[
			"B6","B7","B8", // 5.2
			"B9", // 6.0
			"BA", // 6.2
			"BB","BC","BD", // 7.0
			"BE", // 8.0
			"BF", // 10.0
			"C0", // 14.0
		], uv4x1
	],
	["dingbats", 27, [0,1,2,3,4,5,6,7,8,9,"A","B"], , , "Dingbat",
		[
			"57", // 5.2
			"05","0A","0B","28","4C","4E","53","54","55","5F","60","95","96","97","B0","BF", // 6.0
			"00", // 7.0
		], uv3x2
	],
	["enclosed alphanumerics", 24, [6,7,8,9,"A","B","C","D","E","F"], , , "Enclosed_Alphanumerics"],
	["general punctuation", 20, [1,2,3,4,5], , , "General_Punctuation", , ,
		[
			"11", // NB
			"28","29", // L SEP, P SEP
			"2A","2B", // LRE, RLE
			"2C", // PDF
			"2D","2E", // LRO, RLO
			"2F", // NNB SP
			"5F", // MM SP
		],
	],
	["geometric shapes", 25, ["A","B","C","D","E","F"], , , "Geometric_Shapes_(Unicode_block)"],
	["letterlike symbols", 21, [0,1,2,3,4], , , "Letterlike_Symbols",
		[
			"3C","4C", // 4.1
			"4D","4E", // 5.0
			"4F", // 5.1
		], uv4x0
	],
	["mathematical alphanumeric symbols", "1D4", [0,1,2,3,4,5,6,7,8,9], , ["55","9D"],
		"Mathematical_Alphanumeric_Symbols"
	],
	["mathematical operators", 22, [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], , ,
		"Mathematical_Operators_(Unicode_block)"
	],
	["miscellaneous mathematical symbols-a", 27, ["C","D","E"], , ,
		"Miscellaneous_Mathematical_Symbols-A",
		[
			"C0","C1","C2","C3","C4","C5","C6", // 4.1
			"CA","C7","C8","C9", // 5.0
			"CC","EC","ED","EE","EF", // 5.1
			"CE","CF", // 6.0
			"CB","CD", // 6.1
		], uv3x2
	],
	["miscellaneous mathematical symbols-b", 29, [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], , ,
		"Miscellaneous_Mathematical_Symbols-B"
	],
	["miscellaneous symbols", 26, [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], , ,
		"Miscellaneous_Symbols",
		[
			"B2", // 5.0
			"9D","B3","B4","B5","B6","B7","B8","B9","BA","BB","BC","C0","C1","C2","C3", // 5.1
			"9E","9F","BD","BE","BF","C4","C5","C6","C7","C8","C9","CA","CB","CC","CD","CF",
			"D0","D1","D2","D3","D4","D5","D6","D7","D8","D9","DA","DB","DC","DD","DE","DF",
			"E0","E1","E3","E8","E9","EA","EB","EC","ED","EE","EF",
			"F0","F1","F2","F3","F4","F5","F6","F7","F8","F9","FA","FB","FC","FD","FE","FF", // 5.2
			"CE","E2","E4","E5","E6","E7", // 6.0
		], uv4x1
	],
	["miscellaneous technical", 23, [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], ,
		["29","2A"], // 2 deprecated 5.2
		"Miscellaneous_Technical",
		[
			"DC","DD","DE","DF","E0","E1","E2","E3","E4","E5","E6","E7", // 5.0
			"E8", // 5.2
			"E9","EA","EB","EC","ED","EE","EF","F0","F1","F2","F3", // 6.0
			"F4","F5","F6","F7","F8","F9","FA", // 7.0
			"FB","FC","FD","FE", // 9.0
			"FF", // 10.0
		], uv4x1
	],
	["number forms", 21, [5,6,7,8], -4, , "Number_Forms",
		[
			"85","86","87","88", // 
			"50","51","52","89", // 5.2
			"8A","8B", // 8.0
		], uv5x0
	],
	["optical character recognition", 24, [4,5], -21, ,"Optical_Character_Recognition_(Unicode_block)"],
	["superscripts and subscripts", 20, [7,8,9], -3, ["72","73","8F"],
		"Superscripts_and_Subscripts_(Unicode_block)",
		[
			"95","96","97","98","99","9A","9B","9C", // 6.0
		], uv4x1
	],
	["supplemental arrows-a", 27, ["F"], , ,"Supplemental_Arrows-A"],
	["supplemental arrows-b", 29, [0,1,2,3,4,5,6,7], , ,"Supplemental_Arrows-B"],
	["supplemental mathematical operators", "2A", [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"], , ,
		"Supplemental_Mathematical_Operators"
	],

	// MISC
	["misc"],
	["armenian", "05", [3,4,5,6,7,8], , ["30","57","58","8B","8C"],
		"Armenian_(Unicode_block)",
		[
			"8F", // 6.1
			"8D","8E", // 7.0
			"60","88", // 11.0
		], uv3x0
	],
	["combining diacritical marks", "03", [0,1,2,3,4,5,6], , , "Combining_Diacritical_Marks", , ,
		["4F"] // ignore: CGJ
	],
	["combining diacritical marks for symbols", 20, ["D","E","F"], -15, ,
		"Combining_Diacritical_Marks_for_Symbols",
		[
			"E2","E3", // 3.0
			"E4","E5","E6","E7","E8","E9","EA", // 3.2
			"EB", // 4.1
			"EC","ED","EE","EF", // 5.0
			"F0", // 5.1
		], uv1x0x0
	],
	["combining diacritical marks supplement", "1D", ["C","D","E","F"], , ,
		"Combining_Diacritical_Marks_Supplement",
		[
			"", // 5.1
			"FD", // 5.2
			"FC", // 6.0
			"E7","E8","E9","EA","EB","EC","ED","EE","EF","F0","F1","F2","F3","F4","F5", // 7.0
			"FB", // 9.0
			"F6","F7","F8","F9", // 10.0
			"FA", // 14.0
		], uv5x1
	],
	["control pictures", 24, [0,1,2,3], -25, , "Control_Pictures"],
	["halfwidth and fullwidth forms", "FF", [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E"], -1,
		["00","BF","C0","C1","C8","C9","D0","D1","D8","D9","DD","DE","DF","E7"],
		"Halfwidth_and_Fullwidth_Forms_(Unicode_block)", , ,
		["A0"] // ignore: HW HF
	],
	["mongolian", 18, [0,1,2,3,4,5,6,7,8,9,"A"], -5,
		["1A","1B","1C","1D","1E","1F","79","7A","7B","7C","7D","7E","7F"],
		"Mongolian_(Unicode_block)",
		[
			"AA", // 5.1
			"78", // 11.0
			"05", // 14.0
		], uv3x0,
		["0B","0C","0D","0E","0F"] // ignore: FVS1, FVS2, FVS3, MVS, FVS4
	],
	["thanaa", "07", [8,9,"A","B"], -14, , "Thaana_(Unicode_block)"],
]

let aBlocksSkip = [
	// to easily turn scripts on/off

	// not for production as headers can remain and anchors get fucked up?
	// all 129 scripts are listed here in different buckets for easily
	// generating different everyCode lists

	/* everything not in the other list
	'adlam',
	'bamum',
	'bassa vah',
	'ethiopic',
	'nko',
	'osmanya',
	'tifinagh',
	'vai',
	'cherokee',
	'deseret',
	'osage',
	'unified canadian aboriginal syllabics',
	'old italic',
	'balinese',
	'bengali',
	'buginese',
	'buhid',
	'devanagari',
	'gujarati',
	'gurmukhi',
	'hanunoo',
	'javanese',
	'kannada',
	'khmer',
	'khmer symbols',
	'lao',
	'malayalam',
	'modi',
	'myanmar',
	'new tai lue',
	'oriya',
	'phags-pa',
	'sinhala',
	'sundanese',
	'tagalog',
	'tagbanwa',
	'tai le',
	'tamil',
	'telugu',
	'thai',
	'tibetan',
	'cyrillic supplement',
	'bopomofo',
	'bopomofo extended',
	'cjk compatibility',
	'cjk compatibility forms',
	'cjk symbols and punctuation',
	'cjk radicals supplement',
	'cjk unified ideographs',
	'cjk unified ideographs extension-a',
	'enclosed cjk letters and months',
	'hangul compatibility jamo',
	'hangul jamo',
	'hangul syllables',
	'hiragana',
	'ideographic description characters',
	'kanbun',
	'katakana',
	'katakana phonetic extensions',
	'vertical forms',
	'yi radicals',
	'yi syllables',
	'georgian',
	'georgian extended',
	'georgian supplement',
	'greek and coptic',
	'greek extended',
	'armenian',
	'halfwidth and fullwidth forms',
	'mongolian',
	'thanaa',
	//*/
	
	/* list to reduce collection of all everyCode for fntString codepoints
	// list excludes some obvious crap like modifiers, combining, blocks, latin
	"ethiopic supplement",
	"gothic",
	"ogham",
	"old turkic",
	"runic",
	"tamil supplement",
	"cyrillic",
	"cyrillic extended-a",
	"cyrillic extended-b",
	"cyrillic extended-c",
	"glagolitic",
	"cjk compatibility ideographs",
	"cjk compatibility ideographs supplement",
	"cjk unified ideographs extension-b",
	"kangxi radicals",
	"basic latin",
	"latin-1 supplement",
	"latin extended-a",
	"latin extended-b",
	"latin extended additional",
	"ipa extensions",
	"phonetic extensions",
	"phonetic extensions supplement",
	"spacing modifier letters",
	"arabic",
	"arabic presentation forms-a",
	"arabic supplement",
	"hebrew",
	"mandaic",
	"samaritan",
	"syriac",
	"alphabetic presentation forms",
	"arrows",
	"block elements",
	"box drawing",
	"braille patterns",
	"currency symbols",
	"dingbats",
	"enclosed alphanumerics",
	"general punctuation",
	"geometric shapes",
	"letterlike symbols",
	"mathematical alphanumeric symbols",
	"mathematical operators",
	"miscellaneous mathematical symbols-a",
	"miscellaneous mathematical symbols-b",
	"miscellaneous symbols",
	"miscellaneous technical",
	"number forms",
	"optical character recognition",
	"superscripts and subscripts",
	"supplemental arrows-a",
	"supplemental arrows-b",
	"supplemental mathematical operators",
	"combining diacritical marks",
	"combining diacritical marks for symbols",
	"combining diacritical marks supplement",
	"control pictures",
	//*/
]

let aTest = [
	// these are the "reduce" code points in some scripts
	// known scripts where if the additonal code point is not supported, subsequent code points may not render
	// lets test each in a div or new line against the first min set
	"unified canadian aboriginal syllabics",
	"bengali","devanagari","kannada","malayalam","sinhala","telugu",
	"miscellaneous mathematical symbols-a","superscripts and subscripts",
	// or use this for any small set tests
	// e.g. aTest = aSpacer
]
let isTest = false

s2 = s2.trim()
s3 = s3.trim()
s4 = s4.trim()
s5 = s5.trim()
s12 = s12.trim()
s14 = s14.trim()
sg = sg.trim()
sb = sb.trim()

let oCodesMin = {},
	oCodesMinVersion = {},
	oCodesMax = {},
	oCodesReduce = {},
	oCodesReserved = {},
	oCodesIgnore = {}, // bidirectional, non-printing, control codes etc
	oCodesCounts = {},
	oRanges = {},
	oRangesReduced = {},
	oWiki = {},
	oGroupHeader = {},
	oScriptHeader = {},
	aLegendClean = [],
	aNav = [],
	aDisplay = [],
	aDisplayMax = [],
	oTofuSizes = {},
	tofuSize,
	testParams = ""

let ZWNJ = String.fromCodePoint("0x200C") +" "

let styles = ["none","sans-serif","serif","monospace","cursive","fantasy"]

// FP
let fpTofuData = {},
		fpTofuHashes = [],
		// size
		fpSizeDataOffset = {},
		fpSizeDataBounding = {},
		fpSizeDataClient = {},
		// hashes
		fpSizeHashesOffset = [],
		fpSizeHashesBounding = [],
		fpSizeHashesClient = [],
		// unique sizes
		fpSizeClientUnique = []

// everything
let oCodePoints = {},
	oTempData = {}

function strip(value) {return value.replace(/ /g,"")} 	// strip all spaces

function hyperlink(string) {return " <a target='blank' class='blue' href='"+ string +"'>wiki</a>"}

function toggleitem(item) {
	let	el = document.getElementById(item)
	let style = el.getAttribute("class")
	if (style.includes("hidden")) {
		el.classList.remove("hidden")
	} else {
		el.classList.add("hidden")
	}
}

function get_count(prefix) {
	let name = (dom.allassigned.checked ? "max" : "min")
		+ document.querySelector('input[name="depth"]:checked').value
	let value = oCodesCounts[name]
	let maxValue = oCodesCounts["maxALL"]
	return prefix + (name == "maxALL" ? "all " : "")
		+ value + (name == "maxALL" ? "" : " of "+ maxValue) //+" max chars"
}

function build_title(name, anchor, nameColor, grouptitle, intCodes, intCodesMax) {
	// builds the html code for each script header, including if we need a script group
	let count = intCodes
	let strVersion = oTempData[name]["min version"]
	if (strVersion !== undefined) {
		if (intCodes == intCodesMax) {
			count += sb + " <sup>counts match</sup></span> | " + intCodesMax
		} else {
			count += " <span class='no_color'><sup>"+ strVersion +"</sup></span> | " + intCodesMax
		}
	} else if (intCodes !== intCodesMax) {
		count += sb + " <sup>version</sup>"+ sc +" | "+ intCodesMax
	}
	let strWiki = oTempData[name]["wiki"]
	strWiki = strWiki == undefined ? "" : hyperlink(strWiki)
	let strRange = oTempData[name]["range"]
	if (strRange == undefined) {
		strRange = sb +"[range]"+ sc
	} else {
		strRange =  s14 +" ["+ strRange +"]"+ sc
			+ (aPartial.includes(name) ? " <code class='purple'>P</code>" : "")
			+ (aSelective.includes(name) ? " <code class='purple'>S</code>" : "")
	}

	return (grouptitle !== "" ? oGroupHeader[grouptitle][0] : "") +
		//"<span class='mono script'>"
		"<span class='script'>"
			// name
			+ nameColor + "<a name='"+ anchor + "'></a>"
				+ "<span style='cursor: pointer;' onClick='logConsole(`"+ name + "`)'>" + name + sc + sc
			// char count
			+ s12 + " ["+ count +"]"+ sc + strRange + strWiki
		+ sc
}

function get_tofu_size() {
	// measure some known unassigned + reserved unicode glyphs
	return new Promise(resolve => {
		// list: some reserved code points
		// use multiple scripts to reduce change in greatest occurence over time
		let list = [
			'0x0402', // control: cyrillic: capital Dje
			'0x0386', // control: greek: capital A with acute
			'0x09E5', // bengali
			'0x135C', // ethiopic
			'0x10CF', // georgian
			'0x0AF8', // gujarati
			'0x0A65', // gurmukhi
			'0x03A2', // greek
			'0x0EDB', // lao
			'0x0D65', // malayam
			/* 
			'0x187F', // mongolian
			'0x0DF1', // sinhala
			'0x0BE5', // tamil
			'0x2D7E', // tifinagh
			*/
		]
		let div = dom.ugDiv, span = dom.ugSpan, slot = dom.ugSlot
		let res = {}
		styles.forEach(function(style) {res[style] = []})
		oTofuSizes["test array"] = []

		list.forEach(function(codepoint) {
			oTofuSizes["test array"].push(codepoint +" "+ String.fromCodePoint(codepoint))
			styles.forEach(function(style) {
				slot.style.fontFamily = style
				slot.textContent = String.fromCodePoint(codepoint)
				// use clientrects (more precision): w=span, h=div
				let cDiv = div.getClientRects()
				let cSpan = span.getClientRects()
				let whClient = cSpan[0].width +" x "+ cDiv[0].height
				res[style].push(whClient)
			})
		})
		// reset slot so we don't end up with unwanted scrollbars
		slot.textContent = ""

		// get most common size
		const names = Object.keys(res)
		for (const k of names) {
			let aRes = res[k]
			let getGreatestOccurrence = aRes => aRes.reduce((greatest, currentValue, index, res) => {
				let count = res.filter(item => JSON.stringify(item) == JSON.stringify(currentValue)).length
				if (count > greatest.count) {
					return {count, item: currentValue}
				}
				return greatest
			}, { count: 0, item: undefined })
			let greatest = getGreatestOccurrence(aRes)
			oTofuSizes[k] = [greatest.item, aRes.join(", ")]
		}
		tofuSize = oTofuSizes["none"][0]
		dom.tofuSize.innerHTML = "<span style='cursor: pointer;' onClick='logConsole(`tofusize`)'>" + tofuSize +"</span>"
		return resolve()
	})
}

function prettyObjectArray(json) {
  if (typeof json === 'string') {
    json = JSON.parse(json);
  }
  let output = JSON.stringify(json, function(k,v) {
    if(v instanceof Array)
      return JSON.stringify(v);
    return v;
  }, 3).replace(/\\/g, '')
        .replace(/\"\[/g, '[')
        .replace(/\]\"/g,']')
        .replace(/\"\{/g, '{')
        .replace(/\}\"/g,'}')
        .replace(/,/g,', ');
  return output;
}

function logConsole(type, name) {
	// objects
	let oUsed = {}, logStr = ""
	if (type == "everything") {oUsed = oCodePoints; logStr = "everything"
	} else if (type == "wiki") {oUsed = oWiki; logStr = "wikipedia links"
	} else if (type == "ranges") {oUsed = oRanges; logStr = "ranges used [not all blocks may be used]"
	} else if (type == "rangesreduced") {
		oUsed = oRangesReduced
		logStr = "ranges [reduced] [P: partial | S: selective blocks used from the range]"
	} else if (type == "ignore") {oUsed = oCodesIgnore; logStr = "code points [ignored]"
	} else if (type == "max") {oUsed = oCodesMax; logStr = "code points [max used]"
	} else if (type == "min") {oUsed = oCodesMin; logStr = "code points [min used if reduced]"
	} else if (type == "reduce") {oUsed = oCodesReduce; logStr = "code points [reduce]"
	} else if (type == "reserved") {oUsed = oCodesReserved; logStr = "code points [reserved]"
	} else if (type == "version") {oUsed = oCodesMinVersion; logStr = "unicode [min version if reduced]"
	} else if (type == "fpTofuData") {
		oUsed = fpTofuData; logStr = "tofu | "+ testParams
	} else if (type == "fpSizeDataOffset") {
		oUsed = fpSizeDataOffset; logStr = "offset | "+ testParams
	} else if (type == "fpSizeDataBounding") {
		oUsed = fpSizeDataBounding; logStr = "getBounding | "+ testParams
	} else if (type == "fpSizeDataClient") {
		oUsed = fpSizeDataClient; logStr = "getClientRects | "+ testParams
	} else if (type == "fptofuscript") {
		oUsed = fpTofuData[name]; logStr="tofu ["+ name +"] | "+ testParams
	}
	if (logStr !== "") {
		console.log(logStr+"\n", prettyObjectArray(oUsed))
		return
	}
	// combine
	if (type == "fpsizescript") {
		logStr="sizes ["+ name +"] | "+ testParams
		console.log(
			logStr+"\n"+
			"offset\n", (isOffset ? prettyObjectArray(fpSizeDataOffset[name]) : "n/a"),
			"\ngetBounding\n", (isBounding ? prettyObjectArray(fpSizeDataBounding[name]) : "n/a"),
			"\ngetClientRects\n", prettyObjectArray(fpSizeDataClient[name])
		)
		return
	}

	// arrays
	if (type == "fptofu") {
		logStr = "tofu fingerprint | "+ testParams +" | "+ mini(fpTofuHashes.join()) +"\n  "+ fpTofuHashes.join("\n  ")
	} else if (type == "fpSizeOffset") {
		logStr = "offset | "+ testParams +" | "+ mini(fpSizeHashesOffset.join()) +"\n  "+ fpSizeHashesOffset.join("\n  ")
	} else if (type == "fpSizeBounding") {
		logStr = "getBounding | "+ testParams +" | "+ mini(fpSizeHashesBounding.join()) +"\n  "+ fpSizeHashesBounding.join("\n  ")
	} else if (type == "fpSizeClient") {
		logStr = "getClientRects | "+ testParams +" | "+ mini(fpSizeHashesClient.join()) +"\n  "+ fpSizeHashesClient.join("\n  ")
	}
	if (logStr !== "") {
		console.log(logStr)
		return
	}

	// pretty
	if (type == "tofusize") {
		logStr = "calculated tofu sizes [greatest occurence, results]"
		logStr += "\n==========="
		const names = Object.keys(oTofuSizes).sort()
		for (const k of names) {
			logStr += "\n"+ k
			+ (k == "test array" ? "\n - "+ oTofuSizes[k].join(", ") : "\n - "+ oTofuSizes[k][0])
			+ (k == "test array" ? "" : "\n - "+ oTofuSizes[k][1])
		}
		console.log(logStr)
		return
	}
	// script
	if (oCodePoints[type] !== undefined) {
		console.log(type, prettyObjectArray(oCodePoints[type]))
	}
}

function generate() {
	// do once
	// two sets of codes and characters and clean displays
	// reduce codes/chars
	// reserved code/chars
	// ignore codes
	// range info
	// clean legend
	// get char counts
	return new Promise(resolve => {
		let t0 = performance.now()
		aBlocks.forEach(function(data) {
			let name = data[0].toLowerCase()
			let anchor = strip(name) +"group"
			if (data[1] == undefined) {
				aNav.push(anchor)
			}
		})
		// FP lines
		let strFP = "<span class='mono'>"
			+ s12 + "tofu size: ".padStart(16) + sc +"<span id='runningTofuSize'></span><br>"
			+ s12 + "parameters: ".padStart(16) + sc +"<span id='runningParameters'></span><br>"
			+ s12 +"tofu: ".padStart(16) + sc +"<br>"
			+ s12 +"offset: ".padStart(16) + sc +"<span id='runningStatus'></span><br>"
			+ s12 +"getBounding: ".padStart(16) + sc +"<br>"
			+ s12 +"getClientRects: ".padStart(16) + sc +"</span><br>"
		aDisplay.push(strFP)
		aDisplayMax.push(strFP)

		let aSuffix = [0,1,2,3,4,5,6,7,8,9,"A","B","C","D","E","F"]
		let navIndex = 0,
			navString ="",
			navTop = "<a class='blue' href='#" + aBlocks[0][0].toLowerCase() +"group'> &#9650 TOP</a> &nbsp ",
			navEnd = "<a class='blue' href='#end'> &#9660 END</a></p>",
			grouptitle = ""

		let aCountsMin = []
		let aCountsMax = []
		let namesDebug = []
		aBlocks.forEach(function(data) {
			let name = data[0].toLowerCase()
			let anchor = strip(name)
			if (data[1] == undefined) {
				// group headers
				name = name.toUpperCase()
				anchor += "group"
				navString = "<p class='groupright'>"
				if (anchor !== aNav[0]) {
					navString += navTop + "<a class='blue' href='#"+ aNav[navIndex - 1] +"'> &#9664 PREV</a> &nbsp "
				}
				if (aNav[navIndex + 1] !== undefined) {
					navString += "<a class='blue' href='#"+ aNav[navIndex + 1] +"'> &#9654 NEXT</a> &nbsp "
				}
				navString += navEnd
				aLegendClean.push((navIndex == 0 ? "": "<br>") +"<a class='blue' href='#"+ anchor +"'>"+ name +"</a><br>")
				navIndex++

				let groupStr = "<div><a name='"+ anchor + "'></a>"
					+ "<hr><p class='groupleft'>"
					+ "<u><b><a class='no_color' href='#"+ anchor +"'>"+ name +"</a></b></u>"
					+ "</p>"
					+ navString
					+ "<div style='clear: both;'></div>"
					+ "</div>"

				grouptitle = strip(name).toLowerCase()
				oGroupHeader[grouptitle] = [groupStr]
			} else {
				name = data[0].toLowerCase()
				namesDebug.push(name)
				let go = !isTest
				if (aBlocksSkip.includes(name)) {
					go = false
				} else {
					go = true
				}

				if (isTest && aTest.includes(name)) {go = true}
				if (go) {
					oTempData[name] = {}
					let prefix = data[1],
						range = data[2],
						remove = data[3],
						nonassigned = data[4],
						url = data[5],
						reduce = data[6],
						version = data[7],
						ignore = data[8]
					// fixup vars
					if (nonassigned == undefined) {nonassigned = []}
					if (reduce == undefined) {reduce = []}
					if (ignore == undefined) {ignore = []}
					if (remove == undefined) {remove = 0}
					// range info
					let rangeString = ""+ prefix + range[0] +"0.."+ prefix + range[range.length-1] +"F"
					oTempData[name]["range"] = rangeString
					// partial
					let isPartial = []
					if (aPartial.includes(name)) {isPartial.push("P")}
					if (aSelective.includes(name)) {isPartial.push("S")}
					oTempData[name]["partial"] = isPartial.length ? isPartial.join(", ") : false
					// legend
					aLegendClean.push("<li><a class='no_color' href='#"+ anchor +"'>"+ name +"</a></li>")

					let aCodesMin = [],
						aCodesMax = [],
						aCodesReduce = [],
						aCodesReserved = [],
						aCodesIgnore = [],
						aCharsMin = [],
						aCharsMax = []

					// loop
					for (let i = 0; i < range.length; i++) {
						for (let j = 0; j < aSuffix.length; j++) {
							let string = "0x"+ prefix + range[i] + aSuffix[j]
							let match = ""+ range[i] + aSuffix[j]
							if (ignore.includes(match)) {
								aCodesIgnore.push(string)
							} else if (!nonassigned.includes(match)) {
								aCodesMax.push(string)
								aCharsMax.push(String.fromCodePoint(string))
								if (!reduce.includes(match)) {
									aCodesMin.push(string)
									aCharsMin.push(String.fromCodePoint(string))
								} else {
									aCodesReduce.push(string)
								}
							} else {
								aCodesReserved.push(string)
							}
						}
					}
					// trim results
					if (remove < 0) {
						// add trimmed items to reserved
						let trimReserved = aCodesMin.slice(aCodesMin.length + remove, aCodesMin.length)
						aCodesReserved = aCodesReserved.concat(trimReserved)
						// slice results
						aCodesMin = aCodesMin.slice(0, remove)
						aCodesMax = aCodesMax.slice(0, remove)
						aCharsMin = aCharsMin.slice(0, remove)
						aCharsMax = aCharsMax.slice(0, remove)
					}

					// record
					if (aCodesReserved.length) {oTempData[name]["reserved"] = aCodesReserved}
					if (aCodesIgnore.length) {oTempData[name]["ignored"] = aCodesIgnore}
					oTempData[name]["max count"] = aCodesMax.length
					oTempData[name]["max used"] = aCodesMax
					if (aCodesReduce.length) {
						oTempData[name]["reduce"] = aCodesReduce
						oTempData[name]["min count"] = aCodesMin.length
						oTempData[name]["min used"] = aCodesMin
					}
					if (version !== undefined && version !== "") {oTempData[name]["min version"] = version}
					if (url !== undefined && url !== "") {oTempData[name]["wiki"] = "https://en.wikipedia.org/wiki/"+ url}

					// counts
					aCountsMin.push(aCodesMin.length)
					aCountsMax.push(aCodesMax.length)

					// build clean displays
					let nameColor = s12
					let scriptheader = build_title(name, anchor, nameColor, grouptitle, aCodesMin.length, aCodesMax.length)
					oScriptHeader[name] = [scriptheader]
					aDisplay.push(scriptheader)
					aDisplayMax.push(scriptheader)
					let strStart = "", strEnd = ""
					if (oEnlarge[name] !== undefined) {
						strStart = "<span style='font-size: "+ oEnlarge[name][0] +"px'>"
						strEnd = sc
					}
					let spacer = aSpacer.includes(name) ? " " : ""
					aDisplay.push("<div class='chars'>"+ strStart + spacer + aCharsMin.join(ZWNJ + spacer) + strEnd +"</div>")
					aDisplayMax.push("<div class='chars'>"+ strStart + spacer + aCharsMax.join(ZWNJ + spacer) + strEnd +"</div>")
					// reset grouptitle
					grouptitle = ""
				}
			}
		})
		//console.log("'"+ namesDebug.join("',\n'") +"',")
		aDisplay.push("<a name='end'></a>")
		aDisplayMax.push("<a name='end'></a>")

		// counts
		let min20 =0, min50=0, minAll=0, max20=0, max50=0, maxAll=0
		for (let i=0; i < aCountsMin.length; i++) {
			let minValue = aCountsMin[i],
				maxValue = aCountsMax[i]
			min20 += (minValue > 19 ? 20 : minValue)
			min50 += (minValue > 49 ? 50 : minValue)
			minAll += minValue
			max20 += (maxValue > 19 ? 20 : maxValue)
			max50 += (maxValue > 49 ? 50 : maxValue)
			maxAll += maxValue
		}
		oCodesCounts["min20"] = min20
		oCodesCounts["min50"] = min50
		oCodesCounts["minALL"] = minAll
		oCodesCounts["max20"] = max20
		oCodesCounts["max50"] = max50
		oCodesCounts["maxALL"] = maxAll
		// perf
		dom.perf.innerHTML = "setup: "+ Math.round(performance.now() - t0) +" ms | " + get_count("test ")

		// sort oTempData => sorted objects
		const names = Object.keys(oTempData).sort()
		dom.countScript.innerHTML = "["+ names.length +"]"
		var everyCode = []
		for (const k of names) {
			oCodePoints[k] = oTempData[k]
			if (oTempData[k]["range"] !== undefined) {
				oRanges[k] = oTempData[k]["range"]
			}
			if (oTempData[k]["partial"] !== undefined) {
				let rangeChk = oTempData[k]["partial"]
				if (false !== rangeChk) { // ignore false
					oRangesReduced[k] = oTempData[k]["partial"]
				}
			}
			if (oTempData[k]["max used"] !== undefined) {
				oCodesMax[k] = oTempData[k]["max used"]
				if (aBlocksSkip.length > 0) {
					everyCode = everyCode.concat(oCodesMax[k])
				}
			}
			if (oTempData[k]["ignored"] !== undefined) {
				oCodesIgnore[k] = oTempData[k]["ignored"]
			}
			if (oTempData[k]["reserved"] !== undefined) {
				oCodesReserved[k] = oTempData[k]["reserved"]
			}
			if (oTempData[k]["wiki"] !== undefined) {
				oWiki[k] = oTempData[k]["wiki"]
			}
			if (oTempData[k]["reduce"] !== undefined) {
				oCodesReduce[k] = oTempData[k]["reduce"]
				if (oTempData[k]["min used"] !== undefined) {
					oCodesMin[k] = oTempData[k]["min used"]
				}
			}
			if (oTempData[k]["min version"] !== undefined) {
				oCodesMinVersion[k] = oTempData[k]["min version"]
			}
		}
		if (aBlocksSkip.length > 0) {
			console.log(everyCode.length, everyCode)
			console.log("['"+ everyCode.join("','") +"']")
		}
		// return
		return resolve()
	})
}

function reset(resetperf = true, resetdisplay = true) {
	// reset/display everything to make sure all code points have time to hopefully render
	if (resetperf) {
		dom.perf.innerHTML = get_count("test ")
	}
	if (resetdisplay) {
		dom.legend.innerHTML = aLegendClean.join("")
		dom.visual.innerHTML = dom.allassigned.checked ? aDisplayMax.join("<br>") : aDisplay.join("<br>")
		dom.summary.innerHTML = ""
	}
	if (!resetperf) {isRunning = false}
}

function run() {
	if (!isRunning) {
		// we need to retest tofu size in case user zoomed
		Promise.all([
			get_tofu_size(),
			reset(),
		]).then(function(results){
			isRunning = true
			dom.perf.innerHTML = "running ..."
			dom.runningStatus = "running ... "+ get_count("testing ")
			dom.runningTofuSize.innerHTML = tofuSize + " <span class='btn12 btnc' onClick='logConsole(`tofusize`)'>[details]</span>"
			let testDepth = document.querySelector('input[name="depth"]:checked').value
			testParams = (testDepth == "ALL" ? "all" : "up to "+ testDepth)
				+" | "+ (dom.allassigned.checked ? "max" : "reduced")
			dom.runningParameters = testParams
			setTimeout(function() {
				test(testDepth)
			}, 1)
		})
	}
}

function test(testDepth) {
	dom.perf.innerHTML = "&nbsp"
	// vars
	let aVisual = [],
		aLegend = [],
		aSummary = [],
		countTested = 0,
		countTofu = 0
	let div = dom.ugDiv, span = dom.ugSpan, slot = dom.ugSlot
	let t0 = performance.now()
	slot.style.fontFamily = "none"
	if (testDepth == "ALL") {testDepth = 800}
	let aRed = [], aOrange = [], aYellow = []

	// reset tofu
	fpTofuData = {}
	fpTofuHashes = []
	// reset size data
	fpSizeDataOffset = {}
	fpSizeDataBounding = {}
	fpSizeDataClient = {}
	// reset size hashes
	fpSizeHashesOffset = []
	fpSizeHashesBounding = []
	fpSizeHashesClient = []
	// reset unique sizes
	fpSizeClientUnique = []
	
	let oTempTofu = {},
		oTempSizeOffset = {},
		oTempSizeBounding = {},
		oTempSizeClient = {},
		oTempSizeClientUnique = {}

	aBlocks.forEach(function(data) {
		let name = data[0].toLowerCase()
		let anchor = strip(name)
		if (data[1] == undefined) {
			let firstItem = aBlocks[0].join()
			aLegend.push((name.toLowerCase() == firstItem.toLowerCase() ? "": "<br>")
				+"<a class='blue' href='#"+ anchor +"group'>"+ name.toUpperCase() +"</a><br>")
		} else {
			let go = !isTest
			if (isTest && aTest.includes(name)) {go = true}
			if (go) {
				let codes = dom.allassigned.checked ? oCodePoints[name]["max used"] : oCodePoints[name]["min used"]
				if (oCodePoints[name]["min used"] == undefined) {codes = oCodePoints[name]["max used"]}

				let displayA = []
				let aTofu = []
				let aSizeOffset = [], aSizeBounding = [], aSizeClient = []
				let anchorColor = "no_color", nameColor = s12, partial = ""
				let	maxDepth = (testDepth > codes.length ? codes.length : testDepth)
				maxDepth = maxDepth * 1

				// split into test and remainder
				let codesA = codes.slice(0, maxDepth)
				let codesB = codes.slice(maxDepth, codes.length)
				countTested += codesA.length

				// test
				let aSpanBlock = [], aNonSpanBlock = []
				let spacer = aSpacer.includes(name) ? " " : ""

				for (let i=0; i < codesA.length; i++) {
					let character = String.fromCodePoint(codesA[i])
					slot.textContent = character

					// offset: w=span h=div
					if (isOffset) {
						let whOffset = span.offsetWidth + " x " + div.offsetHeight
						aSizeOffset.push(codesA[i] +": "+ whOffset)
					}

					// bounding: w=div h=span
					if (isBounding) {
						let bDiv = div.getBoundingClientRect()
						let bSpan = span.getBoundingClientRect()
						let whBounding = bSpan.width +" x "+ bDiv.height
						aSizeBounding.push(codesA[i] +": "+ whBounding)
					}

					// client: w=span, h=div
					let cDiv = div.getClientRects()
					let cSpan = span.getClientRects()
					let wClient = cSpan[0].width,
						hClient = cDiv[0].height
					let whClient = wClient +" x "+ hClient
					aSizeClient.push(codesA[i] +": "+ whClient)
					if (whClient == tofuSize) {
						aTofu.push(codesA[i])
						aSpanBlock.push(character)
						if (aNonSpanBlock.length) {
							displayA.push(spacer + aNonSpanBlock.join(ZWNJ + spacer) + ZWNJ)
							aNonSpanBlock = [] // reset
						}
					} else {
						if (aSpanBlock.length) {
							displayA.push(sb + spacer + aSpanBlock.join(ZWNJ + spacer) + sc + ZWNJ)
							aSpanBlock = [] // reset
						}
						aNonSpanBlock.push(character)
					}
					// global unique sizes
					if (oTempSizeClientUnique[wClient] == undefined) {
						oTempSizeClientUnique[wClient] = [hClient]
					} else {
						oTempSizeClientUnique[wClient].push(hClient)
					}
					// ToDo: sizes + count per script

				}
				// add final bit
				if (aSpanBlock.length) {
					displayA.push(sb + spacer + aSpanBlock.join(ZWNJ + spacer) + sc + ZWNJ)
				}
				if (aNonSpanBlock.length) {
					displayA.push(spacer + aNonSpanBlock.join(ZWNJ + spacer) + ZWNJ)
				}

				// track tofu
				if (aTofu.length) {
					countTofu += aTofu.length
					let tofuHash = mini(aTofu.join())
					oTempTofu[name] = {"hash": tofuHash, "data": aTofu}
				}

				if (isOffset) {
					oTempSizeOffset[name] = {"hash": mini(aSizeOffset.join()), "data": aSizeOffset}
				}
				if (isBounding) {
					oTempSizeBounding[name] = {"hash": mini(aSizeBounding.join()), "data": aSizeBounding}
				}
				oTempSizeClient[name] = {"hash": mini(aSizeClient.join()), "data": aSizeClient}

				// remainder
				if (codesB.length > 0) {
					let aRemainderBlock = []
					for (let i=0; i < codesB.length; i++) {
						let character = String.fromCodePoint(codesB[i])
						aRemainderBlock.push(character)
					}
					displayA.push(spacer + aRemainderBlock.join(ZWNJ + spacer) + ZWNJ)
				}

				// colors
				let percent = (aTofu.length/maxDepth) * 100
				let strA = displayA.join("")
				if (percent >= 80) {
					anchorColor = "sb"
					nameColor = sb
					if (percent !== 100) {partial = " ["+ aTofu.length +"/" + maxDepth +"]"}
					aRed.push("<a class='no_color' href='#"+ anchor +"'>"+ name +"</a>" + sb + partial + sc)
				} else if (percent >= 20) {
					nameColor = s2
					partial = s2 +" ["+ aTofu.length +"/" + maxDepth +"]"+ sc
					strA = strA.replace(/bad/g, "s2")
					aOrange.push("<a class='no_color' href='#"+ anchor +"'>"+ name +"</a>"+ partial)
				} else if (percent > 0) {
					//anchorColor = "s4" // too noisy, just let the count be colored
					nameColor = s4
					partial = s4 +" ["+ aTofu.length +"/" + maxDepth +"]"+ sc
					strA = strA.replace(/bad/g, "s4")
					aYellow.push("<a class='no_color' href='#"+ anchor +"'>"+ name +"</a>"+ partial)
				}
				// display
				aLegend.push("<li><a class='"+ anchorColor +"' href='#"+ anchor +"'>"+ name +"</a>" + partial +"</li>")

				// append per script tofu + size clickables
				let fpBtnTofu = ""
				if (aTofu.length) {
					fpBtnTofu = " &nbsp <span class='btn14 btnc mono' onClick='logConsole(`fptofuscript`,`"+ name +"`)'>[tofu]</span>"
				}
				let fpBtnSize = " &nbsp <span class='btn12 btnc mono' onClick='logConsole(`fpsizescript`,`"+ name +"`)'>[sizes]</span>"

				aVisual.push(oScriptHeader[name][0] + fpBtnTofu + fpBtnSize)
				let strStart = "", strEnd = ""
				if (oEnlarge[name] !== undefined) {
					strStart = "<span style='font-size: "+ oEnlarge[name][0] +"px'>"
					strEnd = sc
				}
				aVisual.push("<div class='chars'>" + strStart + strA + strEnd +"</div>")
			}
		}
	})
	// reset slot so we don't end up with unwanted scrollbars
	slot.textContent = ""
	// sort tofu
	const namesTofu = Object.keys(oTempTofu).sort()
	for (const nameT of namesTofu) {
		fpTofuData[nameT] = oTempTofu[nameT]
		fpTofuHashes.push(nameT +": "+ oTempTofu[nameT]["hash"])
	}
	// sort sizes
	if (isOffset) {
		const namesOffset = Object.keys(oTempSizeOffset).sort()
		for (const nameO of namesOffset) {
			fpSizeDataOffset[nameO] = oTempSizeOffset[nameO]
			fpSizeHashesOffset.push(nameO +": "+ oTempSizeOffset[nameO]["hash"])
		}
	}
	if (isBounding) {
		const namesBounding = Object.keys(oTempSizeBounding).sort()
		for (const nameB of namesBounding) {
			fpSizeDataBounding[nameB] = oTempSizeBounding[nameB]
			fpSizeHashesBounding.push(nameB +": "+ oTempSizeBounding[nameB]["hash"])
		}
	}
	const namesClient = Object.keys(oTempSizeClient).sort()
	for (const nameC of namesClient) {
		fpSizeDataClient[nameC] = oTempSizeClient[nameC]
		fpSizeHashesClient.push(nameC +": "+ oTempSizeClient[nameC]["hash"])
	}
	// unique sizes
	const namesUniqueSizes = Object.keys(oTempSizeClientUnique).sort((a,b) => a-b)
	for (const nameU of namesUniqueSizes) {
		let aHeight = oTempSizeClientUnique[nameU]
		aHeight = aHeight.filter(function(item, position) {return aHeight.indexOf(item) === position})
		aHeight.sort((a,b) => a-b)
		aHeight.forEach(function(h) {
			fpSizeClientUnique.push(nameU +" x " + h)
		})
	}

	// FP lines
	let tofuSizeBtn = " <span class='btn12 btnc' onClick='logConsole(`tofusize`)'>[details]</span>"
	let tofuFP = mini(fpTofuHashes.join())
		+ " <span class='btn12 btnc' onClick='logConsole(`fptofu`)'>[summary]</span>"
		+ " <span class='btn12 btnc' onClick='logConsole(`fpTofuData`)'>["+ countTofu +"]</span> "
		+ Math.round((countTofu/countTested) * 100) + "%"
	if (countTofu == 0) {
		tofuFP = testParams == "all | max" ? sg + "OMG! CONGRATS: NO TOFU"+ sc : sg +"none"+ sc +": up your test parameters"
	}

	let sizeFPOffset = zNA
	if (isOffset) {
		sizeFPOffset = mini(fpSizeHashesOffset.join())
			+ " <span class='btn12 btnc' onClick='logConsole(`fpSizeOffset`)'>[summary]</span>"
			+ " <span class='btn12 btnc' onClick='logConsole(`fpSizeDataOffset`)'>["+ countTested +"]</span> "
	}
	let sizeFPBounding = zNA
	if (isBounding) {
		sizeFPBounding = mini(fpSizeHashesBounding.join())
			+ " <span class='btn12 btnc' onClick='logConsole(`fpSizeBounding`)'>[summary]</span>"
			+ " <span class='btn12 btnc' onClick='logConsole(`fpSizeDataBounding`)'>["+ countTested +"]</span> "
	}
	let sizeFPClient = mini(fpSizeHashesClient.join())
		+ " <span class='btn12 btnc' onClick='logConsole(`fpSizeClient`)'>[summary]</span>"
		+ " <span class='btn12 btnc' onClick='logConsole(`fpSizeDataClient`)'>["+ countTested +"]</span> "
		+ " <span class='btn12 btnc' onClick='logConsole(`fpSizeDataClientUnique`)'>["+ fpSizeClientUnique.length +" sizes]</span> "

	let strFP = "<span class='mono'>"
		+ s12 +"tofu size: ".padStart(16) + sc + tofuSize + tofuSizeBtn + "<br>"
		+ s12 +"parameters: ".padStart(16) + sc + testParams +"<br>"
		+ s12 +"tofu: ".padStart(16) + sc + tofuFP +"<br>"
		+ s12 +"offset: ".padStart(16) + sc + sizeFPOffset +"<br>"
		+ s12 +"getBounding: ".padStart(16) + sc + sizeFPBounding +"<br>"
		+ s12 +"getClientRects: ".padStart(16) + sc + sizeFPClient +"</span><br>"

	// display visuals
	aVisual.push("<a name='end'></a>")
	dom.visual.innerHTML = strFP +"<br>"+ aVisual.join("<br>")
	dom.legend.innerHTML = aLegend.join("") +"<br><hr><br>"

	// summary
	if (aRed.length) {
		aRed.sort()
		aSummary.push("<br>"+ sb + "unsupported [" + aRed.length +"]"+ sc +"<br>")
		aSummary.push("<br><li>"+ aRed.join("</li><li>") +"</li>")
	}
	if (aOrange.length) {
		aOrange.sort()
		aSummary.push("<br>"+ s2 + "mixed [" + aOrange.length +"]"+ sc +"<br>")
		aSummary.push("<br><li>" + aOrange.join("</li><li>") +"</li>")
	}
	if (aYellow.length) {
		aYellow.sort()
		aSummary.push("<br>"+ s4 + "partial [" + aYellow.length +"]"+ sc +"<br>")
		aSummary.push("<br><li>"+ aYellow.join("</li><li>") +"</li>")
	}
	dom.summary.innerHTML = "<span class='s12' style='font-size: 12px;'><b><u>"
		+ "SUMMARY</u></b>"+ sc +"<br>"+ aSummary.join("")

	// perf
	dom.perf.innerHTML = Math.round(performance.now() - t0) +" ms | " + get_count("")
	isRunning = false
}

//dom.allassigned.checked = true
let isRunning = true
let isBounding = false
let isOffset = false

if (isFF) {
	isBounding = true
	isOffset = true
}

setTimeout(function() {
	Promise.all([
		get_tofu_size(),
		generate(),
	]).then(function(){
		reset(false) // false: leave the generate perf value there
	})
}, 1)

</script>
</body>
</html>
